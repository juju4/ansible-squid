---

- name: Ensure squid compiled with ssl
  command: squid -v
  register: squidv
  failed_when: "'with-openssl' not in squidv.stdout and '--enable-ssl-crtd ' not in squidv.stdout"

- include_tasks: certificate-selfsigned.yml

- name: Ensure /var/lib/squid exists
  file:
    dest: /var/lib/squid
    state: directory
    mode: '0700'
    owner: squid
    seuser: system_u
    setype: squid_cache_t

- name: Initialize SSL database
  command: /usr/lib64/squid/ssl_crtd -c -s /var/lib/squid/ssl_db
  args:
    creates: /var/lib/squid/ssl_db/index.txt
  become: yes
  become_user: squid
